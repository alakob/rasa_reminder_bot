# Custom Actions\n\nCustom actions allow the Rasa bot to execute Python code, enabling functionalities beyond simple text responses, such as interacting with databases or external APIs.\n\n## Action Server\n\n*   Custom actions run in a separate Python process, the **Action Server**.\n*   The Action Server is defined as the `action_server` service in `docker-compose.yml`.\n*   It runs the command `rasa run actions --debug`.\n*   The Rasa server communicates with the Action Server via an HTTP endpoint defined in `endpoints.yml` (defaulting to `http://action_server:5055/webhook`).\n\n## Implemented Actions (`actions/actions.py`)\n\n**1. `ValidateReminderForm(FormValidationAction)`**\n\n*   **Purpose:** Validates the slots collected by the `reminder_form`.\n*   **Methods:**\n    *   `validate_task`: Ensures the task description is sufficiently long.\n    *   `validate_date`: (Currently accepts any input, basic validation needed).\n    *   `validate_time`: (Currently accepts any input, basic validation needed).\n    *   `validate_time_zone`: Uses `pytz` to check if the provided string is a known timezone.\n*   **Triggered by:** The `reminder_form` defined in `domain.yml`.\n\n**2. `ActionSetReminder(Action)`**\n\n*   **Purpose:** Saves a new reminder to the PostgreSQL database after the `reminder_form` is successfully submitted.\n*   **Current State:** The core logic relying on `dateparser` for flexible date/time input is **temporarily disabled** due to dependency conflicts. The action currently:\n    *   Logs an error.\n    *   Sends a message to the user indicating the feature is disabled.\n    *   Resets the form slots.\n*   **Original Logic (Commented Out):**\n    *   Retrieves `task`, `date`, `time`, `time_zone` slots.\n    *   Calls `parse_datetime_with_timezone` (now removed) to convert user input into a timezone-aware datetime object.\n    *   Calls `convert_to_utc` to get the UTC equivalent for database storage.\n    *   Connects to the database using `asyncpg`.\n    *   Inserts the reminder details (user\_id, task, reminder\_time in UTC) into the `reminders` table.\n    *   Dispatches the `utter_confirm_reminder` response.\n    *   Sets `reminder_confirmed` and `last_reminder_id` slots.\n*   **Triggered by:** The `reminder_form`\'s submit action or potentially directly via stories/rules.\n\n**3. `ActionListReminders(Action)`**\n\n*   **Purpose:** Retrieves and lists reminders for the current user from the database.\n*   **Logic:**\n    *   Gets the `user_id` (sender\_id) from the tracker.\n    *   Connects to the database.\n    *   Queries the `reminders` table for entries matching the `user_id`, ordered by `reminder_time`.\n    *   If reminders are found:\n        *   Formats each reminder for display (potentially converting UTC time back to a user-preferred timezone - currently defaults to UTC or last used `time_zone` slot).\n        *   Sends the list back to the user via `dispatcher.utter_message`.\n    *   If no reminders are found, sends `utter_no_reminders`.\n*   **Triggered by:** Intent `list_reminders` (handled via stories/rules).\n\n**4. `ActionDeleteReminder(Action)`**\n\n*   **Purpose:** Deletes a specific reminder based on user input (e.g., referencing the last reminder set or potentially allowing deletion by task description/time in the future).\n*   **Logic:**\n    *   Gets the `user_id`.\n    *   (Needs logic to identify *which* reminder to delete - currently might use `last_reminder_id` slot if available, otherwise needs enhancement).\n    *   Connects to the database.\n    *   Executes a DELETE query on the `reminders` table.\n    *   Confirms deletion or reports an error/reminder not found.\n*   **Triggered by:** Intent `delete_reminder` (handled via stories/rules).\n\n## Database Interaction\n\n*   Actions connect to the PostgreSQL database using the `asyncpg` library.\n*   Connection details are retrieved from the `DATABASE_URL` environment variable.\n*   Helper functions `get_db_connection` and `close_db_connection` manage the connection lifecycle.\n*   All reminder times are intended to be stored in UTC (`TIMESTAMPTZ` type in PostgreSQL). Timezone conversions happen within the action code before saving or after retrieving.\n\n## Future Enhancements\n\n*   Re-implement `parse_datetime_with_timezone` using Python\'s `datetime` or another library compatible with Rasa 3.5\'s dependencies.\n*   Improve `ActionDeleteReminder` to allow users to specify which reminder to delete more reliably.\n*   Implement user profile storage (e.g., preferred timezone).\n*   Add more robust validation for date and time slots in `ValidateReminderForm`.\n 